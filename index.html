<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SkillPath</title>

  <!-- Preload background if present -->
  <link rel="preload" as="image" href="https://res.cloudinary.com/dxwfxgn5z/image/upload/v1757609577/skillpathnewBackground_xqu8pz.jpg">

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #0f172a, #1e293b);
      color: #f9fafb;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      transition: all 0.5s ease-in-out;
      position: relative;
    }

    body.login-bg {
      background-image: url("https://res.cloudinary.com/dxwfxgn5z/image/upload/v1757609577/skillpathnewBackground_xqu8pz.jpg");
      background-repeat: no-repeat;
      background-position: center center;
      background-size: cover;
      background-blend-mode: overlay;
      background-attachment: fixed;
    }

    .card {
      background: #1f2937;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
      width: 350px;
      text-align: center;
    }

    #loginPage {
      position: absolute;
      right: 48px;
      left: auto;
      top: 50%;
      transform: translateY(-50%);
      width: 360px;
    }

    #skillsPage {
      position: relative;
      margin: 0 auto;
    }

    body.login-bg .card {
      background: rgba(0,0,0,0.55);
      box-shadow: 0 8px 30px rgba(0,0,0,0.6);
      backdrop-filter: blur(6px) saturate(110%);
      -webkit-backdrop-filter: blur(6px) saturate(110%);
      border: 1px solid rgba(255,255,255,0.04);
    }

    h1, h2 {
      margin-bottom: 15px;
      text-shadow: 0 2px 8px rgba(0,0,0,0.6);
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 8px;
      border: 1px solid #374151;
      background: rgba(17,24,39,0.85);
      color: #f9fafb;
      outline: none;
    }
    input::placeholder { color: rgba(249,250,251,0.7); }

    button {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: none;
      border-radius: 8px;
      background: #2563eb;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
    }
    button:hover { background: #1d4ed8; }

    .link {
      margin-top: 10px;
      display: block;
      color: #60a5fa;
      cursor: pointer;
    }
    .hidden { display: none; }
    .info { margin-top: 20px; text-align: left; }
    .info img { width: 60px; margin-bottom: 10px; }
    ul { padding-left: 20px; }
    .small { font-size: 0.9rem; color: #cbd5e1; }
    .error { color: #ffb4b4; margin-top: 6px; }
    .success { color: #b6f6c1; margin-top: 6px; }
    .badge {
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      background:#374151;
      color:#cbd5e1;
      font-size:0.85rem;
      margin-left:8px;
    }

    /* Enlarged roadmap images so content inside is readable.
       max-width increased and a max-height added so the image is large
       but still allows scrolling on smaller screens. object-fit ensures clarity. */
    .skill-roadmap {
      width: 100%;
      max-width: 1400px;  /* increased width for readability as requested */
      max-height: 900px;  /* allow large but not infinite height */
      height: auto;
      margin-top: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 6px 30px rgba(0,0,0,0.45);
      display: block;
      object-fit: contain;
    }

    .roadmap-block {
      background: rgba(255,255,255,0.02);
      padding: 12px;
      border-radius: 8px;
      margin-top: 8px;
    }

    @media (max-width:1200px) {
      .skill-roadmap { max-width: 1000px; max-height: 800px; }
    }

    @media (max-width:900px) {
      #loginPage {
        position: relative;
        right: auto;
        left: auto;
        top: auto;
        transform: none;
        width: 92%;
        margin: 16px auto;
      }
      #skillsPage { margin: 16px auto; }
      .skill-roadmap { max-width: 100%; max-height: 800px; }
    }

    @media (max-width:420px) {
      .card { width: 92%; padding: 20px; }
      .skill-roadmap { max-height: 650px; }
    }
  </style>
</head>
<body>

  <!-- Login / Signup Section -->
  <div id="loginPage" class="card">
    <h2>Welcome-SkillPath</h2>

    <input type="text" id="usernameOrEmail" placeholder="Username or Email">
    <input type="password" id="password" placeholder="Password">

    <button id="loginBtn">Login</button>
    <button id="showSignupBtn">Sign Up</button>
    <button id="skipBtn">Skip Login</button>

    <span class="link" onclick="toggleSignup()">Don‚Äôt have an account? Sign up</span>

    <!-- Signup form (hidden by default) -->
    <div id="signupArea" class="hidden" style="margin-top:12px; text-align:left;">
      <h3 style="margin:8px 0 6px 0;">Create account</h3>
      <input type="text" id="su_username" placeholder="Choose a username (no spaces)">
      <input type="email" id="su_email" placeholder="Email (used to login securely)">
      <input type="password" id="su_password" placeholder="Password (min 6 chars)">
      <button id="createAccountBtn">Create Account</button>
      <div id="signupMsg" class="small"></div>
    </div>

    <div id="loginMsg" class="error"></div>
  </div>

  <!-- Skills Section -->
  <div id="skillsPage" class="card hidden" style="max-width:900px;">
    <h1>Choose Your Skill</h1>
    <div style="text-align:left; margin-bottom:10px;">
      <strong id="welcomeUser">Hello</strong>
      <span id="userType" class="small" style="display:block;"></span>
      <span id="tempBadge" class="badge hidden">Temporary account ‚Äî finalize signup</span>
    </div>

    <select id="skillSelect" onchange="showSkill()">
      <option value="">-- Select a Skill --</option>
      <option value="cpp">üíª C++</option>
      <option value="html">üåê HTML</option>
      <option value="python">üêç Python</option>
      <option value="java">‚òï Java</option>
      <option value="php">üêò PHP</option>
      <option value="r">üìä R</option>
    </select>
    <div class="info" id="skillInfo"></div>
    <button onclick="backToLogin()">‚¨Ö Back</button>
  </div>

  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-functions-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "PASTE_YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
    };

    const FIREBASE_CONFIG_SET = firebaseConfig && firebaseConfig.apiKey && !firebaseConfig.apiKey.includes('PASTE_YOUR');
    let auth = null, db = null, functions = null;
    if (FIREBASE_CONFIG_SET) {
      firebase.initializeApp(firebaseConfig);
      auth = firebase.auth();
      db = firebase.firestore();
      functions = firebase.functions();
      firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL)
        .catch(err => console.warn('Failed to set persistence:', err));
    }

    // Skill data updated with additional important descriptive info (no other logic changed)
    const skillData = {
      cpp: {
        title: "C++ Programming",
        description:
          "Role in CS: C++ powers operating systems, game engines, and high-performance applications. " +
          "Important: learn manual memory management, RAII (Resource Acquisition Is Initialization), and modern C++ (C++11/14/17/20) practices to write safe and efficient code. " +
          "Use cases include embedded systems, real-time applications, and performance-critical modules.",
        benefits: [
          "High performance and efficiency",
          "Supports object-oriented programming (OOP)",
          "Rich Standard Template Library (STL)",
          "Widely used in system-level programming",
          "Great for competitive programming and problem-solving"
        ],
        img: "https://isocpp.org/assets/images/cpp_logo.png",
        roadmap: `
          <div class="roadmap-block">
            <strong>BASICS</strong>
            <ul>
              <li>Data types, variables, I/O</li>
              <li>Functions</li>
              <li>Control structures (if/else, loops)</li>
            </ul>
            <strong>CONTROL STRUCTURES</strong>
            <ul>
              <li>If, switch, for, while</li>
            </ul>
            <strong>DATA TYPES</strong>
            <ul>
              <li>Primitive types, enums, typedefs</li>
            </ul>
            <strong>FUNCTIONS</strong>
            <ul>
              <li>Function overloading, default args, inline</li>
            </ul>
            <strong>STRINGS</strong>
            <ul>
              <li>std::string, c-strings, common operations</li>
            </ul>
            <strong>ARRAYS</strong>
            <ul>
              <li>Static arrays, std::vector, memory layout</li>
            </ul>
            <strong>POINTERS</strong>
            <ul>
              <li>Pointer basics, references, dynamic memory, smart pointers</li>
            </ul>
          </div>
          <img src="https://res.cloudinary.com/dxwfxgn5z/image/upload/v1757610936/c_qea4gx.jpg" alt="C++ Roadmap" class="skill-roadmap">
        `
      },
      html: {
        title: "HTML",
        description:
          "Role in CS: HTML structures content for the web and is the foundation of front-end development. " +
          "Important: focus on semantic HTML, accessibility (a11y), and responsive design to build inclusive and maintainable web pages. Combine with CSS and JavaScript for interactive experiences.",
        benefits: [
          "Easy to learn and implement",
          "Forms the foundation of every website",
          "Works with CSS and JavaScript for full web apps",
          "Cross-platform compatibility",
          "Supported by all browsers and devices"
        ],
        img: "https://upload.wikimedia.org/wikipedia/commons/6/61/HTML5_logo_and_wordmark.svg",
        roadmap: `
          <div class="roadmap-block">
            <h4>HTML Learning Roadmap</h4>
            <strong>Level 1 - Basics (Foundation)</strong>
            <ul>
              <li>What is HTML & how browsers render pages</li>
              <li>HTML document structure</li>
              <li>Common tags</li>
              <li>Text formatting</li>
              <li>Lists</li>
              <li>Links</li>
              <li>Images</li>
              <li>Basic accessibility</li>
            </ul>

            <strong>Level 2 - Structure & Content Semantics</strong>
            <ul>
              <li>Semantic elements</li>
              <li>Grouping content</li>
              <li>Tables</li>
              <li>Forms & inputs</li>
              <li>Form attributes</li>
              <li>HTML5 structural/semantic</li>
              <li>Audio & video</li>
              <li>Responsive images</li>
              <li>Accessibility (a11y)</li>
              <li>SEO basics</li>
              <li>Internationalization</li>
              <li>Progressive enhancement</li>
            </ul>

            <strong>Level 3 - Integration with CSS & JavaScript (Workflow)</strong>
            <ul>
              <li>How HTML, CSS, and JS interact</li>
              <li>Linking CSS & JS</li>
              <li>Using data-attributes</li>
              <li>Accessibility with dynamic content</li>
            </ul>

            <strong>Level 4 - Modern Tooling, Patterns & Production Practices</strong>
            <ul>
              <li>Responsive layout patterns</li>
              <li>Progressive Web App (PWA) basics</li>
              <li>Templating & componentization</li>
              <li>Performance</li>
              <li>Accessibility audits</li>
              <li>Deployment basics</li>
            </ul>
          </div>
          <img src="https://res.cloudinary.com/dxwfxgn5z/image/upload/v1757610946/HTML_Learning_Roadmap_Guide_qlke9r.png" alt="HTML Roadmap" class="skill-roadmap">
        `
      },
      php: {
        title: "PHP",
        description:
          "Role in CS: PHP is a server-side scripting language ideal for building dynamic web backends. " +
          "Important: learn secure handling of user input, prepared statements, and modern PHP practices with Composer and frameworks (Laravel) for scalable apps.",
        benefits: [
          "Great for backend web development",
          "Easy integration with databases",
          "Open source with large community",
          "Fast deployment for web apps",
          "Powering platforms like WordPress and Facebook"
        ],
        img: "https://upload.wikimedia.org/wikipedia/commons/2/27/PHP-logo.svg",
        roadmap: `
          <div class="roadmap-block">
            <h4>PHP Roadmap (5 Levels)</h4>

            <strong>Level 1 - Basics</strong>
            <ul>
              <li>Learn HTML, CSS, JavaScript</li>
              <li>Understand programming concepts (variables, loops, conditionals, functions)</li>
              <li>Install XAMPP/WAMP/LAMP to run PHP locally</li>
              <li>Write first PHP scripts: echo, variables, data types</li>
            </ul>

            <strong>Level 2 - Core PHP</strong>
            <ul>
              <li>Control structures: if, switch, for, while</li>
              <li>Functions & Arrays</li>
              <li>Forms handling (GET & POST)</li>
              <li>File handling (read/write)</li>
              <li>Sessions & Cookies</li>
            </ul>

            <strong>Level 3 - PHP with Databases</strong>
            <ul>
              <li>MySQL basics (CRUD operations)</li>
              <li>PHP with MySQL / PDO</li>
              <li>Prepared statements (prevent SQL injection)</li>
              <li>Build small projects (login form, guestbook, simple blog)</li>
            </ul>

            <strong>Level 4 - Intermediate & OOP</strong>
            <ul>
              <li>Error handling & exceptions</li>
              <li>File uploads, email sending (PHPMailer)</li>
              <li>JSON, XML, REST API basics</li>
              <li>Object-Oriented PHP (Classes, Objects, Inheritance, Interfaces, Traits)</li>
              <li>Security basics: XSS, CSRF, password hashing</li>
            </ul>

            <strong>Level 5 - Advanced & Frameworks</strong>
            <ul>
              <li>Composer (dependency management)</li>
              <li>MVC architecture</li>
              <li>Authentication & Authorization</li>
              <li>Learn a Framework (Laravel recommended)</li>
              <li>Build, test & integration</li>
            </ul>
          </div>
          <img src="https://res.cloudinary.com/dxwfxgn5z/image/upload/v1757610965/php_jxl4aj.jpg" alt="PHP Roadmap" class="skill-roadmap">
        `
      },
      r: {
        title: "R Programming",
        description:
          "Role in CS: R excels at statistical analysis, data visualization, and exploratory data science. " +
          "Important: become familiar with packages (ggplot2, dplyr) and reproducible reports (R Markdown) to communicate data insights effectively.",
        benefits: [
          "Advanced statistical computing capabilities",
          "Rich data visualization tools",
          "Strong in academia and research",
          "Integrates with big data frameworks",
          "Large set of packages for analytics"
        ],
        img: "https://upload.wikimedia.org/wikipedia/commons/1/1b/R_logo.svg",
        roadmap: `
          <div class="roadmap-block">
            <h4>R Language Learning Roadmap</h4>

            <strong>Level 1: Basics of R</strong>
            <ul>
              <li>What is R? Why it's used in statistics & data analysis</li>
              <li>Install R & RStudio</li>
              <li>R syntax, variables, data types</li>
              <li>Vectors, lists, matrices, data frames</li>
            </ul>

            <strong>Level 2: Data Handling & Visualization</strong>
            <ul>
              <li>Import & export data (CSV, Excel, SQL, JSON)</li>
              <li>Data cleaning (missing values, outliers)</li>
              <li>dplyr & tidyr (data manipulation)</li>
              <li>ggplot2 (data visualization) & base plotting</li>
            </ul>

            <strong>Level 3: Statistics & Probability</strong>
            <ul>
              <li>Descriptive statistics (mean, median, variance, SD)</li>
              <li>Probability distributions (normal, binomial, Poisson)</li>
              <li>Hypothesis testing (t-test, chi-square, ANOVA)</li>
            </ul>

            <strong>Level 4: Machine Learning with R</strong>
            <ul>
              <li>Data preprocessing for ML</li>
              <li>Supervised learning: regression, classification (caret, tidymodels)</li>
              <li>Unsupervised learning: clustering, PCA</li>
              <li>Time series forecasting (ARIMA, Prophet)</li>
              <li>Model evaluation & tuning; using R with TensorFlow & Keras</li>
            </ul>

            <strong>Other Practical Topics</strong>
            <ul>
              <li>Writing functions, loops & apply family</li>
              <li>R packages (install, create, manage)</li>
              <li>Debugging & error handling</li>
              <li>Functional programming basics</li>
              <li>R Markdown for reporting</li>
            </ul>
          </div>
          <img src="https://res.cloudinary.com/dxwfxgn5z/image/upload/v1757610990/r_niz52d.jpg" alt="R Roadmap" class="skill-roadmap">
        `
      },
      python: {
        title: "Python",
        description:
          "Role in CS: Python is essential for AI, data science, scripting and rapid application development. " +
          "Important: master ecosystem libraries (pandas, numpy, scikit-learn, tensorflow) and best practices like virtual environments and testing to build reliable projects.",
        benefits: [
          "Readable and beginner-friendly syntax",
          "Huge standard library and community support",
          "Excellent for AI, ML, and data science",
          "Cross-platform and versatile",
          "Strong integration with modern frameworks"
        ],
        img: "https://upload.wikimedia.org/wikipedia/commons/c/c3/Python-logo-notext.svg",
        roadmap: `
          <div class="roadmap-block">
            <h4>Python Learning Roadmap</h4>

            <strong>Level 1: Basics</strong>
            <ul>
              <li>Install Python & IDE (PyCharm, VS Code, Jupyter)</li>
              <li>Python syntax & indentation</li>
              <li>Variables & data types</li>
            </ul>

            <strong>Level 2: Core Python Concepts</strong>
            <ul>
              <li>Functions (def, return, args)</li>
              <li>Data structures: lists, tuples, sets, dictionaries</li>
              <li>String manipulation</li>
              <li>File handling (open, read, write)</li>
              <li>Exception handling (try/except/finally)</li>
              <li>Modules & packages (import, pip)</li>
            </ul>

            <strong>Level 3: Intermediate Python</strong>
            <ul>
              <li>List comprehensions</li>
              <li>Iterators & generators</li>
              <li>Object-Oriented Programming (OOP)</li>
              <li>Lambda functions</li>
              <li>Decorators</li>
              <li>Regular expressions (re module)</li>
            </ul>

            <strong>Level 4: Advanced Python & Libraries</strong>
            <ul>
              <li>Virtual environments & pipenv</li>
              <li>Multithreading / multiprocessing</li>
              <li>Standard libraries (os, sys, datetime, math, random)</li>
              <li>Functional programming & context managers</li>
              <li>Type hinting (PEP 484)</li>
              <li>Web development, cybersecurity tools, IoT projects</li>
            </ul>
          </div>
          <img src="https://res.cloudinary.com/dxwfxgn5z/image/upload/v1757610984/python_ojnuwh.jpg" alt="Python Roadmap" class="skill-roadmap">
        `
      },
      java: {
        title: "Java",
        description:
          "Role in CS: Java powers large enterprise systems, Android apps and cross-platform server software. " +
          "Important: learn JVM internals, memory model, concurrency primitives and using frameworks (Spring) for production-grade applications.",
        benefits: [
          "Platform-independent with JVM",
          "Robust and secure programming model",
          "Massive ecosystem and libraries",
          "Strong OOP principles",
          "Backbone of Android development"
        ],
        img: "https://upload.wikimedia.org/wikipedia/en/3/30/Java_programming_language_logo.svg",
        roadmap: `
          <div class="roadmap-block">
            <h4>Java Learning Roadmap</h4>

            <strong>Level 1 - Basics</strong>
            <ul>
              <li>Introduction to Java & setup</li>
              <li>Java syntax</li>
              <li>Input & output</li>
              <li>Operators & expressions</li>
              <li>Control statements (if, switch, loops)</li>
            </ul>

            <strong>Level 2 - Core Concepts</strong>
            <ul>
              <li>Object-Oriented Programming: classes, objects, inheritance, interfaces</li>
              <li>Collections framework</li>
              <li>Exception handling</li>
            </ul>

            <strong>Level 3 - Frameworks & Tools</strong>
            <ul>
              <li>Maven/Gradle</li>
              <li>JUnit (testing)</li>
              <li>Logging frameworks</li>
            </ul>

            <strong>Level 4 - Application Development</strong>
            <ul>
              <li>Web development with Java (Servlets, JSP, Spring MVC)</li>
            </ul>

            <strong>Level 5 - Advanced & Deployment</strong>
            <ul>
              <li>RESTful APIs</li>
              <li>Microservices architecture</li>
              <li>Cloud deployment (AWS)</li>
            </ul>
          </div>
          <img src="https://res.cloudinary.com/dxwfxgn5z/image/upload/v1757610949/java_vhyqwg.jpg" alt="Java Roadmap" class="skill-roadmap">
        `
      }
    };

    // --- Helpers added:
    function setWelcome(name, isGuest) {
      document.getElementById('welcomeUser').textContent = 'Hello, ' + name;
      document.getElementById('userType').textContent = isGuest ? 'You are using the app as Guest.' : 'Logged in user';
      const badge = document.getElementById('tempBadge');
      const isTemp = sessionStorage.getItem('isTempUser') === 'true';
      if (isTemp) badge.classList.remove('hidden');
      else badge.classList.add('hidden');
    }

    function resetSkillSelection() {
      const skillSelect = document.getElementById('skillSelect');
      const skillInfo = document.getElementById('skillInfo');
      if (skillSelect) skillSelect.selectedIndex = 0;
      if (skillInfo) skillInfo.innerHTML = '';
      // Keep previous storage behaviour if any
      try { localStorage.removeItem('skillpath_lastSkill'); } catch (e) {}
      try { sessionStorage.removeItem('lastSkillSelection'); } catch (e) {}
    }

    // showSkill: renders skill info and the roadmap HTML block (images are now sized larger)
    function showSkill() {
      const val = document.getElementById("skillSelect").value;
      const box = document.getElementById("skillInfo");
      if (!val) { box.innerHTML = ""; return; }
      const data = skillData[val];

      let html = `
        <div style="display:flex; align-items:center; gap:12px;">
          <img src="${data.img}" alt="${data.title}" style="width:60px; height:60px; object-fit:contain;">
          <div>
            <h2 style="margin:0;">${data.title}</h2>
            <div class="small">${data.description}</div>
          </div>
        </div>

        <div style="margin-top:12px;">
          <h3 style="margin-bottom:6px;">Benefits</h3>
          <ul>${data.benefits.map(b => `<li>${b}</li>`).join('')}</ul>
        </div>

        <h3 style="margin-top:14px;">ROAD MAP - ${data.title}</h3>
        <div id="roadmapArea"></div>
      `;

      box.innerHTML = html;

      // insert roadmap HTML if present
      const area = document.getElementById('roadmapArea');
      if (data.roadmap) {
        area.innerHTML = data.roadmap;
        // ensure large images are scrollable on smaller screens
        const imgs = area.querySelectorAll('.skill-roadmap');
        imgs.forEach(img => {
          img.style.display = 'block';
          img.style.width = '100%';
          img.style.maxWidth = '1400px';
          img.style.height = 'auto';
          img.style.objectFit = 'contain';
        });
        // if image is large, allow the page to scroll by ensuring body's overflow is visible
        document.body.style.overflowY = 'auto';
      } else {
        const note = document.createElement('div');
        note.className = 'small';
        note.style.marginTop = '8px';
        note.textContent = 'Roadmap content coming soon.';
        area.appendChild(note);
      }

      // Expand skills container so images don't feel constrained (affects only skills view)
      const skillsEl = document.getElementById('skillsPage');
      if (skillsEl) {
        skillsEl.style.maxWidth = '1400px';
        skillsEl.style.width = '100%';
        skillsEl.style.padding = '36px';
      }
    }

    // --- Auth UI & Handlers (added permanent account & temporary signup)
    const loginBtn = document.getElementById('loginBtn');
    const skipBtn = document.getElementById('skipBtn');
    const showSignupBtn = document.getElementById('showSignupBtn');
    const createAccountBtn = document.getElementById('createAccountBtn');

    function toggleSignup() { document.getElementById('signupArea').classList.toggle('hidden'); }
    showSignupBtn.addEventListener('click', toggleSignup);

    function showLoginMsg(text, isError=true) {
      const el = document.getElementById('loginMsg');
      el.textContent = text;
      el.className = isError ? 'error' : 'success';
    }

    // Permanent credentials: username=skillpath, password=skills -> welcome Admin
    async function handleLogin() {
      const identifier = document.getElementById('usernameOrEmail').value.trim();
      const password = document.getElementById('password').value;
      document.getElementById('loginMsg').textContent = '';

      if (!identifier || !password) {
        showLoginMsg('Enter username/email and password.');
        return;
      }

      // Permanent local admin check (case-insensitive username)
      if (identifier.toLowerCase() === 'skillpath' && password === 'skills') {
        // Log in as Admin
        sessionStorage.setItem('username', 'Admin');
        sessionStorage.setItem('isGuest', 'false');
        sessionStorage.setItem('isTempUser', 'false');
        // mark admin flag (optional)
        sessionStorage.setItem('isAdmin', 'true');

        setWelcome('Admin', false);
        resetSkillSelection();
        goToSkills();
        return;
      }

      // If firebase is configured, try firebase flow (preserve your existing logic)
      if (FIREBASE_CONFIG_SET && auth && db) {
        try {
          let emailToUse = identifier;
          if (!identifier.includes('@')) {
            const unameKey = identifier.toLowerCase();
            const unameDoc = await db.collection('usernames').doc(unameKey).get();
            if (!unameDoc.exists) {
              showLoginMsg('Username not found.');
              return;
            }
            emailToUse = unameDoc.data().email;
          }
          await auth.signInWithEmailAndPassword(emailToUse, password);

          let username = identifier;
          if (identifier.includes('@')) {
            const q = await db.collection('users').where('email', '==', emailToUse).limit(1).get();
            if (!q.empty) username = q.docs[0].data().username || emailToUse;
            else username = emailToUse;
          }

          sessionStorage.setItem('userUID', auth.currentUser.uid);
          sessionStorage.setItem('username', username);
          sessionStorage.setItem('isGuest', 'false');
          sessionStorage.setItem('isTempUser', 'false');
          setWelcome(username, false);
          resetSkillSelection();
          goToSkills();
          return;
        } catch (err) {
          console.error(err);
          showLoginMsg('Login failed: ' + (err.message || err));
          return;
        }
      }

      // Local fallback check (if you rely on fallback user)
      try {
        const raw = localStorage.getItem('local_fallback_user');
        if (!raw) {
          showLoginMsg('No local account available.');
          return;
        }
        const u = JSON.parse(raw);
        if ((identifier.toLowerCase() === u.username.toLowerCase() || identifier === u.email) && password === u.password) {
          sessionStorage.setItem('username', u.username);
          sessionStorage.setItem('isGuest', 'false');
          sessionStorage.setItem('isTempUser', 'false');
          setWelcome(u.username, false);
          resetSkillSelection();
          goToSkills();
        } else {
          showLoginMsg('Local login failed. Use username "skillpath" and password "skills".');
        }
      } catch (e) {
        console.error('Local fallback login error', e);
        showLoginMsg('Login error.');
      }
    }
    loginBtn.addEventListener('click', handleLogin);

    // Create account -> store as temporary account (as requested)
    function handleCreateAccount() {
      const su_username = document.getElementById('su_username').value.trim();
      const su_email = document.getElementById('su_email').value.trim();
      const su_password = document.getElementById('su_password').value;

      const signupMsg = document.getElementById('signupMsg');
      signupMsg.textContent = '';

      if (!su_username) {
        signupMsg.textContent = 'Enter a username.';
        return;
      }
      if (!su_email) {
        signupMsg.textContent = 'Enter an email.';
        return;
      }
      if (!su_password || su_password.length < 6) {
        signupMsg.textContent = 'Password must be at least 6 characters.';
        return;
      }

      // Store temporary signup info in sessionStorage (temporary account)
      const temp = {
        username: su_username,
        email: su_email,
        createdAt: Date.now(),
        status: 'temporary'
      };
      try {
        // store small record in session (temporary until user finalizes)
        sessionStorage.setItem('temp_signup_user', JSON.stringify(temp));
        sessionStorage.setItem('username', su_username);
        sessionStorage.setItem('isGuest', 'false');
        sessionStorage.setItem('isTempUser', 'true');
        // show badge and go to skills
        setWelcome(su_username, false);
        resetSkillSelection();
        goToSkills();
      } catch (e) {
        console.warn('Could not save temporary signup:', e);
        signupMsg.textContent = 'Failed to create temporary account.';
      }
    }
    createAccountBtn.addEventListener('click', handleCreateAccount);

    // Skip remains guest
    function handleSkip() {
      sessionStorage.setItem('isGuest', 'true');
      sessionStorage.removeItem('userUID');
      sessionStorage.setItem('username', 'Guest');
      sessionStorage.setItem('isTempUser', 'false');
      setWelcome('Guest', true);
      resetSkillSelection();
      goToSkills();
    }
    skipBtn.addEventListener('click', handleSkip);

    function goToSkills() {
      document.getElementById("loginPage").classList.add("hidden");
      document.getElementById("skillsPage").classList.remove("hidden");
      document.body.classList.remove('login-bg');
    }

    function backToLogin() {
      document.getElementById("skillsPage").classList.add("hidden");
      document.getElementById("loginPage").classList.remove("hidden");
      document.getElementById("loginMsg").textContent = "";
      document.body.classList.add('login-bg');

      // revert skillsPage sizing to default (if showSkill expanded it)
      const skillsEl = document.getElementById('skillsPage');
      if (skillsEl) {
        skillsEl.style.maxWidth = '900px';
        skillsEl.style.width = '';
        skillsEl.style.padding = '';
      }
    }

    window.addEventListener('load', () => {
      // restore welcome if possible
      const username = sessionStorage.getItem('username');
      const isGuest = sessionStorage.getItem('isGuest') === 'true';
      const isTemp = sessionStorage.getItem('isTempUser') === 'true';
      if (username) setWelcome(username, isGuest || isTemp);

      // ensure login background shows initially
      const loginEl = document.getElementById('loginPage');
      const skillsEl = document.getElementById('skillsPage');
      if (loginEl && !loginEl.classList.contains('hidden') && skillsEl && skillsEl.classList.contains('hidden')) {
        document.body.classList.add('login-bg');
      } else {
        document.body.classList.remove('login-bg');
      }
    });
  </script>
</body>
</html>
